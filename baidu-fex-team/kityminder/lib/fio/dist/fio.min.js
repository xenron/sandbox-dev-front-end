/*!
 * ====================================================
 * Front-end Input and Output Solution - v1.0.0 - 2014-09-04
 * https://github.com/fex-team/fio
 * GitHub: https://github.com/fex-team/fio.git 
 * Copyright (c) 2014 Baidu FEX; Licensed BSD
 * ====================================================
 */
!function(a){function b(a,b){this.id=a,this.username=b}function c(a){this.content=a,this.type=a instanceof Blob?g.file.TYPE_BLOB:"string"==typeof a?g.file.TYPE_TEXT:"object"==typeof a?g.file.TYPE_JSON:g.file.TYPE_UNKNOWN}function d(a){this.setPath(a),this.isDir=!1,this.data=null,this.size=0,this.createTime=new Date,this.modifyTime=new Date}function e(a,b,c){this.user=a,this.file=b,this.access=c||0}function f(a,b,c){this.path=a,this.method=b,this.user=c,this.dupPolicy=g.file.DUP_FAIL,this.newPath=null,this.acl=null,this.extra=null,this.dataType=g.file.TYPE_TEXT}var g={version:"1.0"};g.provider={},g.file={},g.user={};var h={},i=null,j=function(){return new a.resolve(null)},k={check:j,login:j,logout:j,init:j,current:j};d.prototype.setPath=function(a){g.file.anlysisPath(a,this)},g.file.anlysisPath=function(a,b){b=b||{};for(var c=a.split("/");"/"==c[0]||""===c[0];)c.shift();for(;"/"==c[c.length-1]||""===c[c.length-1];)c.pop();if(b.filename=c.pop()||null,b.parentPath=c.length?"/"+c.join("/")+"/":b.filename?"/":null,b.filename){var d=b.filename.split(".");b.extension=d.length>1?"."+d.pop():null,b.name=d.join("."),b.path=b.parentPath+b.filename}else b.path="/";return b},g.user.User=b,g.file.Data=c,g.file.File=d,g.file.Acl=e,g.file.FileRequest=f,g.file.TYPE_TEXT="text",g.file.TYPE_JSON="json",g.file.TYPE_BLOB="blob",g.file.TYPE_UNKNOWN="unknown",g.file.METHOD_READ="read",g.file.METHOD_WRITE="write",g.file.METHOD_LIST="list",g.file.METHOD_MOVE="move",g.file.METHOD_DELETE="delete",g.file.METHOD_MKDIR="mkdir",g.file.METHOD_ACL_READ="readAcl",g.file.METHOD_ACL_WRITE="writeAcl",g.file.DUP_OVERWRITE="overwrite",g.file.DUP_FAIL="fail",g.file.DUP_RENAME="rename",g.file.ACCESS_PUBLIC=1,g.file.ACCESS_READ=2,g.file.ACCESS_WRITE=4,g.file.ACCESS_CREATE=8,g.file.ACCESS_DELETE=16,g.file.ACCESS_ACL_READ=32,g.file.ACCESS_ACL_WRITE=64,g.file.ACCESS_ALL=65534,g.provider.register=function(a,b){if(h[a]=b,i||(i=b),"function"!=typeof b.handle)throw new Error("Not implement: provider.handle()")},g.provider.use=function(a){i=h[a]},g.provider.init=function(a,b){var c=h[a];return c&&"function"==typeof c.init?c.init.call(c,b):null},g.user.impl=function(a){k=a},["check","login","logout","init","current"].forEach(function(a){g.user[a]=function(){return k[a].apply(k,arguments)}}),["read","write","list","move","delete","mkdir","readAcl","writeAcl"].forEach(function(b){g.file[b]=function(c){return g.user.check().then(function(d){var e=c.provider?h[c.provider]:i,j=new f(c.path,b,d);"read"==b&&(j.dataType=c.dataType||g.file.TYPE_TEXT),"write"==b&&(j.dupPolicy=c.ondup,j.data=new g.file.Data(c.content),delete c.ondup),"move"==b&&(j.newPath=c.newPath,delete c.newPath),"writeAcl"==b&&(j.acl=c.acl,delete c.acl),delete c.provider,delete c.path,j.extra=c;var k=e.handle(j);return a.resolve(k)})}}),window.fio=g}(Promise);