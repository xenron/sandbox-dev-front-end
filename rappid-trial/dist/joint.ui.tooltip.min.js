/*! Rappid v1.7.1 - HTML5 Diagramming Framework - TRIAL VERSION

Copyright (c) 2015 client IO

 2016-03-03 


This Source Code Form is subject to the terms of the Rappid Trial License
, v. 2.0. If a copy of the Rappid License was not distributed with this
file, You can obtain one at http://jointjs.com/license/rappid_v2.txt
 or from the Rappid archive as was distributed by client IO. See the LICENSE file.*/


joint.ui.Tooltip=joint.mvc.View.extend({className:"tooltip",options:{left:void 0,right:void 0,top:void 0,bottom:void 0,padding:10,target:void 0,rootTarget:void 0,trigger:"hover",viewport:{selector:void 0,padding:0},template:'<div class="tooltip-arrow"/><div class="tooltip-arrow-mask"/><div class="tooltip-content"/>'},init:function(){this.eventNamespace="."+this.className+this.cid;var a=this.options.trigger.split(" ");_.bindAll(this,"render","hide","show","toggle","isVisible","position"),this.options.rootTarget?(this.$rootTarget=$(this.options.rootTarget),_.each(a,function(a){switch(a){case"click":this.$rootTarget.on("click"+this.eventNamespace,this.options.target,this.toggle);break;case"hover":this.$rootTarget.on("mouseover"+this.eventNamespace,this.options.target,this.render),this.$rootTarget.on("mouseout"+this.eventNamespace,this.options.target,this.hide),this.$rootTarget.on("mousedown"+this.eventNamespace,this.options.target,this.hide);break;case"focus":this.$rootTarget.on("focusin"+this.eventNamespace,this.options.target,this.render),this.$rootTarget.on("focusout"+this.eventNamespace,this.options.target,this.hide)}},this)):(this.$target=$(this.options.target),_.each(a,function(a){switch(a){case"click":this.$target.on("click"+this.eventNamespace,this.toggle);break;case"hover":this.$target.on("mouseover"+this.eventNamespace,this.render),this.$target.on("mouseout"+this.eventNamespace,this.hide),this.$target.on("mousedown"+this.eventNamespace,this.hide);break;case"focus":this.$target.on("focusin"+this.eventNamespace,this.render),this.$target.on("focusout"+this.eventNamespace,this.hide)}},this)),this.$el.addClass(this.options.direction),this.$el.append(this.options.template)},onRemove:function(){this.options.rootTarget?this.$rootTarget.off(this.eventNamespace):this.$target.off(this.eventNamespace)},hide:function(){this.$el.remove()},show:function(){var a=this.$target?this.$target[0]:this.options.target;this.render({target:a})},toggle:function(){this.isVisible()?this.hide():this.show()},isVisible:function(){return document.body.contains(this.el)},render:function(a){var b,c=!_.isUndefined(a.x)&&!_.isUndefined(a.y);c?b=a:(this.$target=$(a.target).closest(this.options.target),b=this.$target[0]),this.$(".tooltip-content").html(_.isFunction(this.options.content)?this.options.content(b):this.options.content),this.$el.hide(),$(document.body).append(this.$el);var d=this.$("img");d.length?d.on("load",_.bind(function(){this.position(c?b:void 0)},this)):this.position(c?b:void 0),this.$el.addClass("rendered")},position:function(a){var b;b=a?{x:a.x,y:a.y,width:1,height:1}:joint.util.getElementBBox(this.$target[0]);var c=this.options.padding;this.$el.show();var d={width:this.$el.outerWidth(),height:this.$el.outerHeight()};if(this.options.left){var e=$(_.isFunction(this.options.left)?this.options.left(this.$target[0]):this.options.left),f=joint.util.getElementBBox(e[0]);_.extend(d,{x:f.x+f.width+c,y:b.y+b.height/2-d.height/2})}else if(this.options.right){var g=$(_.isFunction(this.options.right)?this.options.right(this.$target[0]):this.options.right),h=joint.util.getElementBBox(g[0]);_.extend(d,{x:h.x-d.width-c,y:b.y+b.height/2-d.height/2})}else if(this.options.top){var i=$(_.isFunction(this.options.top)?this.options.top(this.$target[0]):this.options.top),j=joint.util.getElementBBox(i[0]);_.extend(d,{x:b.x+b.width/2-d.width/2,y:j.y+j.height+c})}else if(this.options.bottom){var k=$(_.isFunction(this.options.bottom)?this.options.bottom(this.$target[0]):this.options.bottom),l=joint.util.getElementBBox(k[0]);_.extend(d,{x:b.x+b.width/2-d.width/2,y:l.y-d.height-c})}else _.extend(d,{x:b.x+b.width+c,y:b.y+b.height/2-d.height/2});d=this.respectViewport(d);var m={};this.options.left||this.options.right?m.top=b.y+b.height/2-d.top:this.options.top||this.options.bottom?m.left=b.x+b.width/2-d.left:m.top=b.y+b.height/2-d.top,this.$el.css(_.pick(d,"top","left")),this.$(".tooltip-arrow, .tooltip-arrow-mask").css(m)},respectViewport:function(a){a.top=a.y,a.left=a.x,a.right=a.left+a.width,a.bottom=a.top+a.height;var b=joint.util.getElementBBox(this.options.viewport.selector||"html"),c=parseInt(this.$el.css("marginLeft"),10),d=parseInt(this.$el.css("marginTop"),10);return this.options.viewport.selector||(b.width=$(window).width()+window.scrollX,b.height=$(window).height()+window.scrollY),b.top=b.y-d,b.left=b.x-c,b.right=b.left+b.width,b.bottom=b.top+b.height,a.left<b.left?a.left=a.x=b.left+this.options.viewport.padding:a.right>b.right&&(a.left=a.x=b.right-this.options.viewport.padding-a.width),a.top<b.top?a.top=a.y=b.top+this.options.viewport.padding:a.bottom>b.bottom&&(a.top=a.y=b.bottom-this.options.viewport.padding-a.height),a}});